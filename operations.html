<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Математика</title>
    <style>
        /* Basic reset and centering */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;  /* Light gray background */
            margin: 0;
            padding: 0;
            min-height: 100vh;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* Game container */
        #game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: min(90vw, 400px);
            padding: 20px 0;
        }

        /* Equation display */
        #equation {
            font-size: clamp(32px, 10vw, 64px);
            color: #333;
            font-weight: 400;
            letter-spacing: 0.02em;
            margin: 10px 0;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .box {
            width: clamp(35px, 10vw, 50px);
            height: clamp(35px, 10vw, 50px);
            border: 2px solid #999;
            border-radius: 4px;
            display: inline-block;
            margin: 0 5px;
        }

        /* Operators grid */
        #operators {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: min(4vw, 20px);
            width: min(85vw, 360px);
            margin: 10px 0;
            visibility: visible;
            opacity: 1;
            transition: opacity 0.3s ease-out;
        }

        #operators.hidden {
            visibility: hidden;
            opacity: 0;
        }

        .operator {
            background: white;
            border: none;
            border-radius: 20px;
            aspect-ratio: 1;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: #60ACBD;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-style: italic;
        }

        /* Plus sign */
        .operator:nth-child(1)::before {
            content: '+';
            font-size: clamp(96px, 32vw, 164px);
            line-height: 1;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-style: italic;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Minus sign */
        .operator:nth-child(2)::before {
            content: '−';
            font-size: clamp(84px, 28vw, 166px);
            line-height: 1;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-style: italic;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Multiplication sign */
        .operator:nth-child(3)::before {
            content: '×';
            font-size: clamp(90px, 30vw, 165px);
            line-height: 1;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-style: italic;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Division sign */
        .operator:nth-child(4)::before {
            content: '÷';
            font-size: clamp(90px, 30vw, 165px);
            line-height: 1;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-style: italic;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            top: 50%;  /* Override previous top value */
        }

        .operator.selected {
            background-color: #60ACBD;
            color: white;
        }

        /* Message display */
        #message {
            font-size: clamp(18px, 4vw, 24px);
            color: #666;
            text-align: center;
            margin: 10px 0;
            padding: 0 20px;
            min-height: 1.2em; /* Reserve space for one line */
        }

        /* Level display */
        #levelDisplay {
            position: fixed;
            top: max(15px, env(safe-area-inset-top));
            right: max(15px, env(safe-area-inset-right));
            font-size: clamp(16px, 4vw, 20px);
            padding: 10px 15px;
            border-radius: 6px;
            background: rgba(0,0,0,0.1);
            color: #666;
        }

        /* Start button */
        #startButton {
            padding: clamp(12px, 3vw, 20px) clamp(20px, 5vw, 40px);
            font-size: clamp(16px, 4vw, 18px);
            min-height: 44px;
            min-width: 44px;
            margin: 10px;
            border: none;
            border-radius: min(2vw, 5px);
            background-color: #60ACBD;
            color: white;
            cursor: pointer;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            box-shadow: 0 4px 12px rgba(96, 172, 189, 0.2);
        }

        #startButton:hover {
            background-color: #4d8a98;
        }

        /* Instructions */
        #instructions {
            font-size: clamp(24px, 6vw, 32px);
            color: #666;
            text-align: center;
            margin-top: 40px;
            font-weight: 400;
        }

        /* Safe area insets */
        @supports (padding: max(0px)) {
            body {
                padding: max(10px, env(safe-area-inset-top))
                         max(10px, env(safe-area-inset-right))
                         max(10px, env(safe-area-inset-bottom))
                         max(10px, env(safe-area-inset-left));
            }
        }

        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
            pointer-events: none;
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Update and add these animation styles */
        @keyframes tapAnimation {
            0% {
                transform: scale(1);
                background-color: white;
                color: #60ACBD;
            }
            50% {
                transform: scale(0.95);
                background-color: #4CAF50;
                color: white;
            }
            75% {
                transform: scale(0.98);
                background-color: #4CAF50;
                color: white;
            }
            100% {
                transform: scale(1);
                background-color: white;
                color: #60ACBD;
            }
        }

        @keyframes wrongTapAnimation {
            0% {
                transform: scale(1);
                background-color: white;
                color: #60ACBD;
            }
            15% {
                transform: scale(0.95) translateX(-4px);
                background-color: #FF6B6B;
                color: white;
            }
            30% {
                transform: scale(0.97) translateX(4px);
            }
            45% {
                transform: scale(0.98) translateX(-2px);
            }
            60% {
                transform: scale(0.99) translateX(2px);
            }
            75% {
                transform: scale(1);
                background-color: #FF6B6B;
                color: white;
            }
            100% {
                transform: scale(1);
                background-color: white;
                color: #60ACBD;
            }
        }

        /* Add ripple effect for wrong answers */
        @keyframes wrongRipple {
            0% {
                box-shadow: 0 8px 24px rgba(0,0,0,0.1),
                            0 0 0 0 rgba(255, 107, 107, 0.3);
            }
            30% {
                box-shadow: 0 4px 12px rgba(0,0,0,0.08),
                            0 0 0 20px rgba(255, 107, 107, 0);
            }
            100% {
                box-shadow: 0 8px 24px rgba(0,0,0,0.1),
                            0 0 0 0 rgba(255, 107, 107, 0);
            }
        }

        /* Add ripple effect for correct answers */
        @keyframes correctRipple {
            0% {
                box-shadow: 0 8px 24px rgba(0,0,0,0.1),
                            0 0 0 0 rgba(76, 175, 80, 0.3);
            }
            30% {
                box-shadow: 0 4px 12px rgba(0,0,0,0.08),
                            0 0 0 20px rgba(76, 175, 80, 0);
            }
            100% {
                box-shadow: 0 8px 24px rgba(0,0,0,0.1),
                            0 0 0 0 rgba(76, 175, 80, 0);
            }
        }

        .operator.tapped {
            animation: 
                tapAnimation 0.3s ease-out,
                correctRipple 0.3s ease-out;
        }

        .operator.wrong {
            animation: 
                wrongTapAnimation 0.6s ease-out,
                wrongRipple 0.6s ease-out;
        }

        /* Add font-face for fallback */
        @font-face {
            font-family: 'Cambria Math';
            src: local('Cambria Math');
        }

        /* Add these new animations to the CSS */
        @keyframes revealOperator {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeInEquation {
            from {
                opacity: 0.5;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Add responsive adjustments */
        @media (max-width: 480px) {
            #game {
                gap: 15px;
                padding: 10px 0;
            }

            #operators {
                gap: 15px;
            }

            .operator {
                font-size: clamp(72px, 24vw, 96px) !important;
            }

            #message {
                font-size: clamp(16px, 4vw, 20px);
            }

            #startButton {
                padding: 12px 30px;
                font-size: clamp(16px, 4vw, 20px);
            }

            #levelDisplay {
                font-size: clamp(14px, 3.5vw, 16px);
                padding: 8px 12px;
            }
        }

        /* Add box-sizing to all elements */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* Update the CSS for equation container and Russian text */
        .equation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .math-equation {
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }

        .russian-equation {
            font-size: clamp(18px, 5vw, 26px);
            color: #4CAF50;
            text-align: center;
            margin-top: 20px;
            min-height: 5em;
            visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            width: 100%;
            padding: 15px;
            max-width: 100vw;
            box-sizing: border-box;
        }

        .translation-line {
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            gap: 12px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 5px 0;
        }

        .translation-line .flag {
            flex: 0 0 auto;
            margin-top: 0.2em;
        }

        .translation-text {
            flex: 1 1 auto;
            min-width: 0;
            text-align: left;
            white-space: normal;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
            padding-right: 10px;
        }

        .russian-equation.visible {
            visibility: visible;
            animation: slideIn 0.3s ease-out forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Add media query for very small screens */
        @media (max-width: 360px) {
            .russian-equation {
                font-size: 15px;
                gap: 10px;
            }
            
            .translation-line {
                gap: 3px;
            }

            .translation-text {
                min-width: 120px;
            }
        }

        /* Update media queries */
        @media (max-width: 480px) {
            .russian-equation {
                padding: 10px;
                gap: 15px;
            }
            
            .translation-line {
                gap: 8px;
                padding: 3px 0;
            }
        }
    </style>
</head>
<body>
    <div id="levelDisplay">Уровень 1</div>
    <div id="game">
        <div id="equation">2 <div class="box"></div> 3 = 6</div>
        <div id="operators">
            <button class="operator" data-operator="+"></button>
            <button class="operator" data-operator="−"></button>
            <button class="operator" data-operator="×"></button>
            <button class="operator" data-operator="÷"></button>
        </div>
        <div id="message">Выбери правильный знак</div>
    </div>
    <button id="startButton">Начать игру</button>

    <script>
        class OperationsGame {
            // Game configuration constants
            static CONSTANTS = {
                // Number constraints
                MAX_NUMBER: 20,
                MIN_NUMBER: 1,
                
                // Multiplication limits
                MAX_MULTIPLIER: 4,
                MAX_DIVISOR: 5,
                MAX_QUOTIENT: 4,
                
                // Animation timings (in ms)
                ANIMATION_DURATION: {
                    FADE_OUT: 300,
                    CORRECT_TAP: 300,
                    WRONG_TAP: 600,
                    SHOW_RESULT: 1000
                },
                
                // Visual settings
                COLORS: {
                    CORRECT: '#4CAF50',
                    WRONG: '#FF6B6B',
                    OPERATOR: '#60ACBD'
                },
                
                // Operation symbols
                OPERATORS: {
                    ADD: '+',
                    SUBTRACT: '−',
                    MULTIPLY: '×',
                    DIVIDE: '÷'
                }
            };

            constructor() {
                this.initializeElements();
                this.initializeGame();
                this.bindEventListeners();
            }

            initializeElements() {
                this.equation = document.getElementById('equation');
                this.operators = document.getElementById('operators');
                this.message = document.getElementById('message');
                this.startButton = document.getElementById('startButton');
                this.levelDisplay = document.getElementById('levelDisplay');
                this.operatorButtons = document.querySelectorAll('.operator');
            }

            initializeGame() {
                this.level = 1;
                this.isPlaying = false;
                this.currentProblem = null;
                this.operationsQueue = [];
            }

            bindEventListeners() {
                this.startButton.addEventListener('click', () => this.startGame());
                this.operatorButtons.forEach(button => {
                    button.addEventListener('click', (e) => this.handleOperatorClick(e));
                });
            }

            startGame() {
                this.isPlaying = true;
                this.level = 1;
                this.startButton.classList.add('fade-out');
                setTimeout(() => {
                    this.startButton.remove();
                }, 300);
                this.generateProblem();
            }

            generateProblem() {
                const operations = [
                    { symbol: OperationsGame.CONSTANTS.OPERATORS.ADD, func: (a, b) => a + b },
                    { symbol: OperationsGame.CONSTANTS.OPERATORS.SUBTRACT, func: (a, b) => a - b },
                    { symbol: OperationsGame.CONSTANTS.OPERATORS.MULTIPLY, func: (a, b) => a * b },
                    { symbol: OperationsGame.CONSTANTS.OPERATORS.DIVIDE, func: (a, b) => a / b }
                ];

                // If queue is empty, create new shuffled queue
                if (this.operationsQueue.length === 0) {
                    this.operationsQueue = [...operations];
                    // Fisher-Yates shuffle
                    for (let i = this.operationsQueue.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [this.operationsQueue[i], this.operationsQueue[j]] = 
                        [this.operationsQueue[j], this.operationsQueue[i]];
                    }
                }

                const operation = this.operationsQueue.pop();
                let a, b, result;
                let validProblem = false;
                const { MAX_NUMBER, MIN_NUMBER, MAX_MULTIPLIER, MAX_DIVISOR, MAX_QUOTIENT } = OperationsGame.CONSTANTS;

                while (!validProblem) {
                    switch (operation.symbol) {
                        case OperationsGame.CONSTANTS.OPERATORS.ADD:
                            a = Math.floor(Math.random() * (MAX_NUMBER / 2)) + MIN_NUMBER;
                            b = Math.floor(Math.random() * (MAX_NUMBER - a)) + MIN_NUMBER;
                            result = a + b;
                            break;

                        case OperationsGame.CONSTANTS.OPERATORS.SUBTRACT:
                            a = Math.floor(Math.random() * MAX_NUMBER) + MIN_NUMBER;
                            b = Math.floor(Math.random() * a) + MIN_NUMBER;
                            result = a - b;
                            break;

                        case OperationsGame.CONSTANTS.OPERATORS.MULTIPLY:
                            a = Math.floor(Math.random() * MAX_MULTIPLIER) + MIN_NUMBER;
                            b = Math.floor(Math.random() * (MAX_NUMBER / a)) + MIN_NUMBER;
                            result = a * b;
                            break;

                        case OperationsGame.CONSTANTS.OPERATORS.DIVIDE:
                            b = Math.floor(Math.random() * MAX_DIVISOR) + MIN_NUMBER;
                            result = Math.floor(Math.random() * MAX_QUOTIENT) + MIN_NUMBER;
                            a = b * result;
                            break;
                    }

                    // Check if only one operation gives this result
                    const validOperations = operations.filter(op => {
                        try {
                            const testResult = op.func(a, b);
                            return testResult === result && 
                                   testResult <= MAX_NUMBER && 
                                   testResult >= 0 && 
                                   testResult % 1 === 0;
                        } catch {
                            return false;
                        }
                    });

                    if (validOperations.length === 1 && 
                        validOperations[0].symbol === operation.symbol &&
                        a <= MAX_NUMBER && b <= MAX_NUMBER && result <= MAX_NUMBER) {
                        validProblem = true;
                    }
                }

                this.currentProblem = {
                    a, b, result,
                    correctOperator: operation.symbol
                };

                // Update equation display
                const equationContainer = document.createElement('div');
                equationContainer.className = 'equation-container';

                const mathEquation = document.createElement('div');
                mathEquation.className = 'math-equation';

                mathEquation.innerHTML = `
                    <span>${this.currentProblem.a}</span>
                    <div class="box"></div>
                    <span>${this.currentProblem.b}</span>
                    <span>=</span>
                    <span>${this.currentProblem.result}</span>
                `;

                equationContainer.appendChild(mathEquation);

                // Add empty Russian equation placeholder
                const russianText = document.createElement('div');
                russianText.className = 'russian-equation';
                russianText.innerHTML = '&nbsp;'; // Non-breaking space to maintain height

                equationContainer.appendChild(russianText);

                this.equation.innerHTML = '';
                this.equation.appendChild(equationContainer);

                this.message.textContent = 'Выбери правильный знак';
                this.message.style.visibility = 'visible';
                this.levelDisplay.textContent = `Уровень ${this.level}`;
            }

            handleOperatorClick(event) {
                if (!this.isPlaying) return;

                const button = event.target;
                const selectedOperator = button.dataset.operator;
                const { ANIMATION_DURATION, COLORS } = OperationsGame.CONSTANTS;
                
                this.operatorButtons.forEach(btn => {
                    btn.classList.remove('tapped', 'wrong', 'selected');
                });

                if (selectedOperator === this.currentProblem.correctOperator) {
                    button.classList.add('tapped');
                    this.level++;
                    
                    // Hide operator buttons
                    this.operators.classList.add('hidden');
                    
                    // Show complete equation with animation
                    const equationContainer = document.querySelector('.equation-container');
                    const mathEquation = equationContainer.querySelector('.math-equation');
                    mathEquation.style.animation = 'fadeInEquation 0.3s ease-out';

                    // Replace the box with the operator
                    const box = mathEquation.querySelector('.box');
                    const operatorSpan = document.createElement('span');
                    operatorSpan.textContent = selectedOperator;
                    operatorSpan.style.color = COLORS.CORRECT;
                    operatorSpan.style.animation = 'revealOperator 0.4s ease-out';
                    operatorSpan.style.display = 'inline-block';
                    box.replaceWith(operatorSpan);

                    const russianText = equationContainer.querySelector('.russian-equation');
                    russianText.innerHTML = `
                        <div class="translation-line">
                            <span class="flag">🇷🇺</span>
                            <span class="translation-text">${this.getNumberWord(this.currentProblem.a)} ${this.getOperatorWord(selectedOperator)} ${this.getNumberWord(this.currentProblem.b)} равно ${this.getNumberWord(this.currentProblem.result)}</span>
                        </div>
                        <div class="translation-line">
                            <span class="flag">🇬🇧</span>
                            <span class="translation-text">${this.getNumberWordEn(this.currentProblem.a)} ${this.getOperatorWordEn(selectedOperator)} ${this.getNumberWordEn(this.currentProblem.b)} equals ${this.getNumberWordEn(this.currentProblem.result)}</span>
                        </div>
                        <div class="translation-line">
                            <span class="flag">🇪🇸</span>
                            <span class="translation-text">${this.getNumberWordEs(this.currentProblem.a)} ${this.getOperatorWordEs(selectedOperator)} ${this.getNumberWordEs(this.currentProblem.b)} es igual a ${this.getNumberWordEs(this.currentProblem.result)}</span>
                        </div>
                    `;
                    russianText.classList.add('visible');

                    // Hide the message during equation display
                    this.message.style.visibility = 'hidden';

                    // Update the proceedHandler to show buttons again
                    const proceedHandler = () => {
                        document.body.removeEventListener('click', proceedHandler);
                        button.classList.remove('tapped');
                        this.message.style.visibility = 'visible';
                        this.operators.classList.remove('hidden');
                        this.generateProblem();
                    };

                    // Wait for click anywhere to proceed
                    setTimeout(() => {
                        document.body.addEventListener('click', proceedHandler);
                    }, 500);
                } else {
                    button.classList.add('wrong');
                    setTimeout(() => {
                        button.classList.remove('wrong');
                    }, ANIMATION_DURATION.WRONG_TAP);
                }
            }

            getOperatorWord(symbol) {
                switch(symbol) {
                    case '+': return 'плюс';
                    case '−': return 'минус';
                    case '×': return 'умножить на';
                    case '÷': return 'разделить на';
                    default: return '';
                }
            }

            getOperatorWordEn(symbol) {
                switch(symbol) {
                    case '+': return 'plus';
                    case '−': return 'minus';
                    case '×': return 'times';
                    case '÷': return 'divided by';
                    default: return '';
                }
            }

            getOperatorWordEs(symbol) {
                switch(symbol) {
                    case '+': return 'más';
                    case '−': return 'menos';
                    case '×': return 'por';
                    case '÷': return 'entre';
                    default: return '';
                }
            }

            getNumberWord(num) {
                const words = {
                    0: 'ноль', 1: 'один', 2: 'два', 3: 'три', 4: 'четыре',
                    5: 'пять', 6: 'шесть', 7: 'семь', 8: 'восемь', 9: 'девять',
                    10: 'десять', 11: 'одиннадцать', 12: 'двенадцать', 13: 'тринадцать',
                    14: 'четырнадцать', 15: 'пятнадцать', 16: 'шестнадцать',
                    17: 'семнадцать', 18: 'восемнадцать', 19: 'девятнадцать', 20: 'двадцать'
                };
                return words[num] || num.toString();
            }

            getNumberWordEn(num) {
                const words = {
                    0: 'zero', 1: 'one', 2: 'two', 3: 'three', 4: 'four',
                    5: 'five', 6: 'six', 7: 'seven', 8: 'eight', 9: 'nine',
                    10: 'ten', 11: 'eleven', 12: 'twelve', 13: 'thirteen',
                    14: 'fourteen', 15: 'fifteen', 16: 'sixteen',
                    17: 'seventeen', 18: 'eighteen', 19: 'nineteen', 20: 'twenty'
                };
                return words[num] || num.toString();
            }

            getNumberWordEs(num) {
                const words = {
                    0: 'cero', 1: 'uno', 2: 'dos', 3: 'tres', 4: 'cuatro',
                    5: 'cinco', 6: 'seis', 7: 'siete', 8: 'ocho', 9: 'nueve',
                    10: 'diez', 11: 'once', 12: 'doce', 13: 'trece',
                    14: 'catorce', 15: 'quince', 16: 'dieciséis',
                    17: 'diecisiete', 18: 'dieciocho', 19: 'diecinueve', 20: 'veinte'
                };
                return words[num] || num.toString();
            }
        }

        // Initialize game when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new OperationsGame();
        });
    </script>
</body>
</html> 